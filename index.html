<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>LIFF æ¸¬è©¦</title>
  <script src="https://static.line-scdn.net/liff/edge/2.21/sdk.js"></script>
</head>
<body>
  <h2 id="status">è«‹ç¨å€™ï¼Œæ­£åœ¨åˆå§‹åŒ– LIFF...</h2>

  <!-- è®“ä½¿ç”¨è€…è¼¸å…¥è³‡æ–™ -->
  <div id="form-container" style="display:none;">
    <label>è«‹è¼¸å…¥ã€Œèª°æ˜¯æ­»é˜¿è‚¥ã€ï¼š</label>
    <input type="text" id="answer1" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ"><br><br>

    <label>è«‹è¼¸å…¥ã€Œèª°ä¸Šå®—å¸«ã€ï¼š</label>
    <input type="text" id="answer2" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ"><br><br>

    <button onclick="submitToGoogleForm()">æäº¤è³‡æ–™</button>
  </div>

  <script>
    let userId = "";
    let displayName = "";

    async function initLIFF() {
      console.log("ğŸš€ é–‹å§‹åˆå§‹åŒ– LIFF...");

      if (typeof liff === "undefined") {
        console.error("âŒ LIFF SDK æœªæ­£ç¢ºè¼‰å…¥ï¼");
        document.getElementById("status").innerHTML = "âŒ LIFF SDK æœªè¼‰å…¥ï¼Œè«‹é‡æ–°æ•´ç†";
        return;
      }

      try {
        await liff.init({ liffId: "2007045157-vQ7lX7j2" });

        console.log("âœ… LIFF åˆå§‹åŒ–æˆåŠŸï¼");
        document.getElementById("status").innerHTML = "âœ… LIFF åˆå§‹åŒ–æˆåŠŸï¼";

        if (!liff.isLoggedIn()) {
          console.log("ğŸ”„ ä½¿ç”¨è€…æœªç™»å…¥ï¼ŒåŸ·è¡Œç™»å…¥...");
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        userId = profile.userId;
        displayName = profile.displayName;
        console.log("ğŸ¯ LINE User ID:", userId);
        console.log("ğŸ‘¤ ä½¿ç”¨è€…åç¨±:", displayName);

        // é¡¯ç¤ºè¼¸å…¥è¡¨å–®
        document.getElementById("status").innerHTML = `<h2>LINE User IDï¼š${userId}</h2>`;
        document.getElementById("form-container").style.display = "block";

      } catch (error) {
        console.error("âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼", error);
        document.getElementById("status").innerHTML = `<h2>âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼š${error.message}</h2>`;
      }
    }

    function submitToGoogleForm() {
      const answer1 = document.getElementById("answer1").value;
      const answer2 = document.getElementById("answer2").value;

      if (!answer1 || !answer2) {
        alert("è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½å¾Œå†æäº¤ï¼");
        return;
      }

      // âœ… é€™è£¡å¡«å…¥ä½ çš„ Google è¡¨å–® ID
      const googleFormURL = "https://docs.google.com/forms/d/e/1FAIpQLSeyaUKYnq8WsLBE9VOIlFVAF1j_Mos0lxzL-PP54gAQyVs2gg/viewform?usp=pp_url"
        + "&entry.248378342=" + encodeURIComponent(userId)  // LINE User ID
        + "&entry.2126815580=" + encodeURIComponent(answer1)  // ä½¿ç”¨è€…è¼¸å…¥çš„ã€Œèª°æ˜¯æ­»é˜¿è‚¥ã€
        + "&entry.102721434=" + encodeURIComponent(answer2); // ä½¿ç”¨è€…è¼¸å…¥çš„ã€Œèª°ä¸Šå®—å¸«ã€

      console.log("ğŸ”— è·³è½‰ Google è¡¨å–®ï¼š", googleFormURL);

      // 3 ç§’å¾Œè·³è½‰
      setTimeout(() => {
        window.location.href = googleFormURL;
      }, 3000);
    }

    window.onload = initLIFF;
  </script>
</body>
</html>
