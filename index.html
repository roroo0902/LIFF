<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>LIFF æ¸¬è©¦</title>
  <!-- ç¢ºä¿ SDK æ­£ç¢ºè¼‰å…¥ -->
  <script src="https://static.line-scdn.net/liff/edge/2.21/sdk.js" onload="initLIFF()"></script>
</head>
<body>
  <h2 id="status">è«‹ç¨å€™ï¼Œæ­£åœ¨åˆå§‹åŒ– LIFF...</h2>
  
  <script>
    async function initLIFF() {
      console.log("ğŸš€ é–‹å§‹åˆå§‹åŒ– LIFF...");

      // 1ï¸âƒ£ ç¢ºä¿ LIFF SDK æ­£ç¢ºè¼‰å…¥
      if (typeof liff === "undefined") {
        console.error("âŒ LIFF SDK æœªæ­£ç¢ºè¼‰å…¥ï¼");
        document.getElementById("status").innerHTML = "âŒ LIFF SDK æœªè¼‰å…¥ï¼Œè«‹é‡æ–°æ•´ç†";
        return;
      }

      try {
        // 2ï¸âƒ£ æ›¿æ›æˆä½ çš„ LIFF ID
        await liff.init({ liffId: "2007045157-vQ7lX7j2" });

        console.log("âœ… LIFF åˆå§‹åŒ–æˆåŠŸï¼");
        document.getElementById("status").innerHTML = "âœ… LIFF åˆå§‹åŒ–æˆåŠŸï¼";

        // 3ï¸âƒ£ å¦‚æœæœªç™»å…¥ï¼Œå…ˆç™»å…¥
        if (!liff.isLoggedIn()) {
          console.log("ğŸ”„ ä½¿ç”¨è€…æœªç™»å…¥ï¼ŒåŸ·è¡Œç™»å…¥...");
          liff.login();
          return;
        }

        // 4ï¸âƒ£ å–å¾— LINE ä½¿ç”¨è€…è³‡è¨Š
        const profile = await liff.getProfile();
        const userId = profile.userId;
        const displayName = profile.displayName;
        console.log("ğŸ¯ LINE User ID:", userId);
        console.log("ğŸ‘¤ ä½¿ç”¨è€…åç¨±:", displayName);

        // 5ï¸âƒ£ åœ¨ç•«é¢ä¸Šé¡¯ç¤º User ID
        document.getElementById("status").innerHTML = `<h2>LINE User IDï¼š${userId}</h2>`;

        // 6ï¸âƒ£ è‡ªå‹•å¡«å¯« Google è¡¨å–®
        const googleFormURL = "https://docs.google.com/forms/d/e/YOUR_GOOGLE_FORM_ID/viewform?usp=pp_url"
          + "&entry.248378342=" + encodeURIComponent(userId)  // æ›¿æ›ç‚ºä½ çš„ Google è¡¨å–®æ¬„ä½ ID
          + "&entry.2126815580=" + encodeURIComponent(displayName); // ä¹Ÿå¯å¡«å…¥ LINE åç¨±

        console.log("ğŸ”— è·³è½‰ Google è¡¨å–®ï¼š", googleFormURL);

        // 7ï¸âƒ£ ä¸‰ç§’å¾Œè‡ªå‹•è·³è½‰åˆ° Google è¡¨å–®
        setTimeout(() => {
          window.location.href = googleFormURL;
        }, 3000);

      } catch (error) {
        console.error("âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼", error);
        document.getElementById("status").innerHTML = `<h2>âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼š${error.message}</h2>`;
      }
    }
  </script>
</body>
</html>
