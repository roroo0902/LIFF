<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>LIFF 測試</title>
  <script src="https://static.line-scdn.net/liff/edge/2.21/sdk.js"></script>
</head>
<body>
  <h2 id="status">請稍候，正在初始化 LIFF...</h2>

  <!-- 讓使用者輸入資料 -->
  <div id="form-container" style="display:none;">
    <label>請輸入「誰是死阿肥」：</label>
    <input type="text" id="answer1" placeholder="請輸入答案"><br><br>

    <label>請輸入「誰上宗師」：</label>
    <input type="text" id="answer2" placeholder="請輸入答案"><br><br>

    <button onclick="submitToGoogleForm()">提交資料</button>
  </div>

  <script>
    let userId = "";
    let displayName = "";

    async function initLIFF() {
      console.log("🚀 開始初始化 LIFF...");

      if (typeof liff === "undefined") {
        console.error("❌ LIFF SDK 未正確載入！");
        document.getElementById("status").innerHTML = "❌ LIFF SDK 未載入，請重新整理";
        return;
      }

      try {
        await liff.init({ liffId: "2007045157-vQ7lX7j2" });

        console.log("✅ LIFF 初始化成功！");
        document.getElementById("status").innerHTML = "✅ LIFF 初始化成功！";

        if (!liff.isLoggedIn()) {
          console.log("🔄 使用者未登入，執行登入...");
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        userId = profile.userId;
        displayName = profile.displayName;
        console.log("🎯 LINE User ID:", userId);
        console.log("👤 使用者名稱:", displayName);

        // 顯示輸入表單
        document.getElementById("status").innerHTML = `<h2>LINE User ID：${userId}</h2>`;
        document.getElementById("form-container").style.display = "block";

      } catch (error) {
        console.error("❌ LIFF 初始化失敗！", error);
        document.getElementById("status").innerHTML = `<h2>❌ LIFF 初始化失敗：${error.message}</h2>`;
      }
    }

    function submitToGoogleForm() {
      const answer1 = document.getElementById("answer1").value;
      const answer2 = document.getElementById("answer2").value;

      if (!answer1 || !answer2) {
        alert("請填寫所有欄位後再提交！");
        return;
      }

      // ✅ 這裡填入你的 Google 表單 ID
      const googleFormURL = "https://docs.google.com/forms/d/e/1FAIpQLSeyaUKYnq8WsLBE9VOIlFVAF1j_Mos0lxzL-PP54gAQyVs2gg/viewform?usp=pp_url"
        + "&entry.248378342=" + encodeURIComponent(userId)  // LINE User ID
        + "&entry.2126815580=" + encodeURIComponent(answer1)  // 使用者輸入的「誰是死阿肥」
        + "&entry.102721434=" + encodeURIComponent(answer2); // 使用者輸入的「誰上宗師」

      console.log("🔗 跳轉 Google 表單：", googleFormURL);

      // 3 秒後跳轉
      setTimeout(() => {
        window.location.href = googleFormURL;
      }, 3000);
    }

    window.onload = initLIFF;
  </script>
</body>
</html>
